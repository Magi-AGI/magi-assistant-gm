# ── Required ──────────────────────────────────────────────────────────────────
ANTHROPIC_API_KEY=your-anthropic-api-key
WIKI_MCP_URL=                          # Hard dependency — assistant will not start without this

# ── MCP Server URLs ──────────────────────────────────────────────────────────
DISCORD_MCP_URL=http://127.0.0.1:3001
FOUNDRY_MCP_URL=http://127.0.0.1:3002

# ── MCP Auth Tokens (optional per-server) ────────────────────────────────────
DISCORD_MCP_TOKEN=
FOUNDRY_MCP_TOKEN=
WIKI_MCP_TOKEN=

# ── Output ───────────────────────────────────────────────────────────────────
DISCORD_ADVICE_WEBHOOK_URL=            # Optional: Discord webhook for backup advice delivery

# ── Claude Model ─────────────────────────────────────────────────────────────
ANTHROPIC_MODEL=claude-sonnet-4-5-20250929

# ── Timing / Triggers ────────────────────────────────────────────────────────
MIN_ADVICE_INTERVAL_SECONDS=180        # P1/P1-H exempt
EVENT_BATCH_WINDOW_SECONDS=30          # P1/P1-H flush immediately
SCENE_OVERRUN_THRESHOLD_MINUTES=3      # P3 pacing alert threshold
ACTIVE_SILENCE_SECONDS=90              # P4 silence detection threshold
SLEEP_SILENCE_MINUTES=15               # ACTIVE → SLEEP transition
TRANSCRIPT_WINDOW_MINUTES=20           # Recent transcript in context
FINAL_SEGMENTS_ONLY=true               # Ignore interim STT segments

# ── v3: Session Pacing Gates ─────────────────────────────────────────────────
SESSION_END_TIME=                      # ISO 8601 or HH:MM — set per session (or /endtime HH:MM)
CONVERGENCE_GATE_MINUTES=45            # Fire P2 at SESSION_END_TIME minus this
DENOUEMENT_GATE_MINUTES=20             # Fire P2 at SESSION_END_TIME minus this

# ── v3: Auto-ACTIVE Detection ────────────────────────────────────────────────
AUTO_ACTIVE_ENABLED=true               # Transcript-based PREGAME→ACTIVE fallback
AUTO_ACTIVE_WINDOW_MINUTES=5           # Rolling window for proper noun detection
AUTO_ACTIVE_THRESHOLD=3                # Distinct campaign terms to trigger activation
AUTO_ACTIVE_MIN_TERM_LENGTH=4          # Skip short terms from phrase hints

# ── v3: GM Hesitation Detection (P1-H) ───────────────────────────────────────
HESITATION_SILENCE_SECONDS=5           # Silence after filled pause to trigger gap-fill
HESITATION_KEYWORDS=["what's the","uh","um","his name","her name","their name","the thing","remind me","i forget"]

# ── Identity ─────────────────────────────────────────────────────────────────
GM_IDENTIFIER=                         # GM's Discord userId, displayName, or speaker label
TARGET_GUILD_ID=                       # Filter sessions by Discord guild

# ── Context / Memory ─────────────────────────────────────────────────────────
MAX_CONTEXT_TOKENS=20000               # Hard ceiling per invocation
ADVICE_MAX_TOKENS=2048                 # Max tokens for Claude response
ADVICE_MEMORY_SIZE=5                   # Rolling ALREADY ADVISED buffer size
NPC_CACHE_MAX_BRIEF_WORDS=60           # Max words per NPC brief

# ── Paths / Data Files ───────────────────────────────────────────────────────
SYSTEM_PROMPT_PATH=./prompts/system.md
CAMPAIGN_WIKI_CARD=                    # Wiki card for episode plan context
STT_FUZZY_MATCH_PATH=./config/fuzzy-match.json

# ── State Persistence (opt-in crash recovery) ────────────────────────────────
STATE_PERSISTENCE_ENABLED=false
STATE_PERSISTENCE_PATH=./.runtime/gm-state.json
STATE_PERSISTENCE_MAX_AGE_MINUTES=360  # Discard persisted state older than this

# ── Discord → Character Mappings ─────────────────────────────────────────────
# JSON object: {"DiscordUsername":"FoundryCharacterName",...}
USER_MAPPINGS=
